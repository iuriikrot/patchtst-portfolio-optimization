# Результаты исследования

**Автор:** Кротов Ю.В., НИУ ВШЭ
**Дата:** Январь 2026

---

## 1. Параметры эксперимента

| Параметр | Значение |
|----------|----------|
| Период данных | 2010-01-01 — 2024-12-31 |
| Количество акций | 20 (из 10 секторов S&P 500) |
| Окно обучения | 1260 дней (5 лет) |
| Горизонт прогноза | 21 день (1 месяц) |
| Безрисковая ставка | 4% годовых |
| Количество периодов | 119 |
| Ковариационная матрица | Ledoit-Wolf |
| Ограничения весов | min=1%, max=20%, long-only |

### Параметры PatchTST (full mode)

| Параметр | Значение |
|----------|----------|
| input_length | 252 (1 год) |
| pred_length | 21 |
| patch_length | 16 |
| stride | 8 |
| d_model | 128 |
| n_heads | 16 |
| n_layers | 3 |
| d_ff | 512 |
| dropout | 0.1 |
| mask_ratio | 0.15 |
| pretrain_epochs | 20 |
| finetune_epochs | 10 |
| learning_rate | 0.01 |

---

## 2. Сравнение портфельных метрик

| Метрика | Baseline 1 | StatsForecast | PatchTST | Лучший |
|---------|------------|---------------|----------|--------|
| **Annual Return** | **16.08%** | 13.08% | 12.20% | Baseline 1 |
| **Annual Volatility** | 12.83% | 13.26% | **12.13%** | PatchTST |
| **Sharpe Ratio** | **0.93** | 0.70 | 0.69 | Baseline 1 |
| **Calmar Ratio** | 0.66 | 0.63 | **0.78** | PatchTST |
| **Max Drawdown** | -24.22% | -20.72% | **-15.72%** | PatchTST |
| **Total Return** | **338.71%** | 238.30% | 213.03% | Baseline 1 |

### Интерпретация результатов

1. **По доходности:** Baseline 1 (историческое среднее) показал наивысшую доходность — 16.08% годовых и 338.71% за весь период.

2. **По риску:** PatchTST продемонстрировал наименьший риск:
   - Минимальная волатильность: 12.13%
   - Минимальная просадка: -15.72% (vs -24.22% у Baseline 1)

3. **По соотношению доходность/риск:**
   - Sharpe Ratio: Baseline 1 лидирует (0.93)
   - Calmar Ratio: PatchTST лидирует (0.78) — лучшее соотношение доходности к максимальной просадке

---

## 3. Метрики качества прогнозов

| Метрика | Baseline 1 | StatsForecast | PatchTST |
|---------|------------|---------------|----------|
| **RMSE** | **0.0695** | 0.0698 | 0.0768 |
| **MAE** | **0.0506** | 0.0510 | 0.0559 |
| **Hit Rate** | **56.13%** | 52.77% | 51.22% |

### Интерпретация

- Все три метода показывают схожую точность прогнозов (RMSE ≈ 0.07)
- Hit Rate (доля верных направлений) незначительно выше 50% — финансовые ряды сложно прогнозируемы
- Baseline 1 имеет лучшие метрики прогнозов, несмотря на простоту метода

---

## 4. Ключевые выводы

### 4.1. Гипотеза не подтвердилась

**Исходная гипотеза:** Замена исторических средних на прогнозы PatchTST улучшит качество портфеля Марковица.

**Результат:** Гипотеза **не подтвердилась** в данном эксперименте. Классический подход (историческое среднее) показал лучшие результаты по Sharpe Ratio и общей доходности.

### 4.2. Преимущества PatchTST

Несмотря на более низкую доходность, PatchTST показал важные преимущества в управлении рисками:

| Метрика риска | Baseline 1 | PatchTST | Улучшение |
|---------------|------------|----------|-----------|
| Max Drawdown | -24.22% | -15.72% | +35% |
| Volatility | 12.83% | 12.13% | +5% |
| Calmar Ratio | 0.66 | 0.78 | +18% |

**Вывод:** PatchTST формирует более консервативные портфели с меньшими просадками.

### 4.3. Возможные причины результатов

1. **Сложность прогнозирования финансовых рядов**
   - Финансовые временные ряды содержат высокий уровень шума
   - Историческое среднее может быть робастной оценкой при высокой неопределённости

2. **Эффект "regression to mean"**
   - Историческое среднее сглаживает выбросы
   - ML-модели могут переобучаться на шуме

3. **Параметры модели**
   - Возможно, требуется более длительное обучение
   - Гиперпараметры могут быть не оптимальны для финансовых данных

4. **Особенности периода 2015-2024**
   - Включает COVID-19 кризис (2020)
   - Высокая волатильность затрудняет прогнозирование

---

## 5. Рекомендации для дальнейших исследований

1. **Увеличить период обучения PatchTST**
   - Увеличить pretrain_epochs и finetune_epochs
   - Использовать больше данных для pretraining

2. **Добавить дополнительные признаки**
   - Макроэкономические индикаторы
   - Технические индикаторы
   - Sentiment данные

3. **Исследовать другие архитектуры**
   - Сравнить с Informer, Autoformer, FEDformer
   - Попробовать supervised режим PatchTST

4. **Использовать ансамблевые методы**
   - Комбинация Historical Mean + PatchTST
   - Взвешенное усреднение прогнозов

5. **Протестировать на других данных**
   - Другие рынки (европейский, азиатский)
   - Криптовалюты (более волатильные)
   - Товарные рынки

---

## 6. Практическое значение

Для практического применения результаты исследования показывают:

| Цель инвестора | Рекомендуемый подход |
|----------------|---------------------|
| Максимальная доходность | Baseline 1 (историческое среднее) |
| Минимальная просадка | PatchTST |
| Баланс риск/доходность | Baseline 1 или комбинация |

**Для консервативных инвесторов** PatchTST может быть предпочтительнее благодаря меньшим просадкам (-15.72% vs -24.22%).

**Для агрессивных инвесторов** историческое среднее даёт более высокую доходность.

---

## 7. Итоговая таблица результатов

```
============================================================
ПОРТФЕЛЬНЫЕ МЕТРИКИ (119 периодов, 2015-2024)
============================================================

Метрика                    Baseline 1      StatsF    PatchTST
-------------------------------------------------------------
Annual Return                  16.08%      13.08%      12.20%
Annual Volatility              12.83%      13.26%      12.13%
Sharpe Ratio                     0.93        0.70        0.69
Calmar Ratio                     0.66        0.63        0.78
Max Drawdown                  -24.22%     -20.72%     -15.72%
Total Return                  338.71%     238.30%     213.03%

============================================================
МЕТРИКИ ПРОГНОЗОВ
============================================================

Метрика                    Baseline 1      StatsF    PatchTST
-------------------------------------------------------------
RMSE                         0.069522    0.069783    0.076804
MAE                          0.050634    0.051043    0.055938
Hit Rate                       56.13%      52.77%      51.22%
```

---

## Заключение

Исследование показало, что в контексте портфельной оптимизации Марковица классический подход с использованием исторического среднего для оценки ожидаемых доходностей превосходит более сложные методы прогнозирования (AutoARIMA и PatchTST) по показателю Sharpe Ratio.

Однако PatchTST демонстрирует значительное преимущество в управлении рисками, формируя портфели с меньшими просадками и волатильностью. Это делает данный подход привлекательным для консервативных инвесторов, ориентированных на сохранение капитала.

Результаты согласуются с известным в финансовой литературе наблюдением о сложности прогнозирования доходностей и эффективности простых методов оценки ожидаемой доходности.
